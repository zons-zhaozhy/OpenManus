<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenManus - AIéœ€æ±‚åˆ†æåŠ©æ‰‹</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --color-primary: #2563eb;
            --color-primary-hover: #1d4ed8;
            --color-secondary: #64748b;
            --color-background: #ffffff;
            --color-surface: #f8fafc;
            --color-border: #e2e8f0;
            --color-text: #1e293b;
            --color-text-secondary: #64748b;
            --color-success: #10b981;
            --color-warning: #f59e0b;
            --color-error: #ef4444;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
            --radius: 0.5rem;
        }

        [data-theme="dark"] {
            --color-background: #0f172a;
            --color-surface: #1e293b;
            --color-border: #334155;
            --color-text: #f1f5f9;
            --color-text-secondary: #94a3b8;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--color-background);
            color: var(--color-text);
            line-height: 1.5;
            overflow: hidden;
        }

        .app-container {
            display: flex;
            height: 100vh;
            width: 100vw;
        }

        /* ä¾§è¾¹æ  */
        .sidebar {
            width: 280px;
            background: var(--color-surface);
            border-right: 1px solid var(--color-border);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
        }

        .sidebar-header {
            padding: 1rem;
            border-bottom: 1px solid var(--color-border);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.25rem;
            font-weight: 600;
        }

        .sidebar-content {
            flex: 1;
            padding: 1rem;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            border-radius: var(--radius);
            cursor: pointer;
            transition: background 0.2s;
            margin-bottom: 0.5rem;
        }

        .nav-item:hover {
            background: var(--color-primary);
            color: white;
        }

        .nav-item.active {
            background: var(--color-primary);
            color: white;
        }

        /* ä¸»å†…å®¹åŒº */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        /* é¡¶éƒ¨æ  */
        .top-bar {
            height: 60px;
            background: var(--color-surface);
            border-bottom: 1px solid var(--color-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 1.5rem;
        }

        .page-title {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .top-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--color-primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--color-primary-hover);
        }

        .btn-secondary {
            background: transparent;
            color: var(--color-text-secondary);
            border: 1px solid var(--color-border);
        }

        .btn-secondary:hover {
            background: var(--color-surface);
        }

        /* èŠå¤©ç•Œé¢ */
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            max-height: calc(100vh - 60px);
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .message {
            max-width: 80%;
            animation: fadeIn 0.3s ease;
        }

        .message.user {
            align-self: flex-end;
        }

        .message.assistant {
            align-self: flex-start;
        }

        .message-content {
            padding: 1rem 1.25rem;
            border-radius: 1rem;
            position: relative;
        }

        .message.user .message-content {
            background: var(--color-primary);
            color: white;
            border-bottom-right-radius: 0.25rem;
        }

        .message.assistant .message-content {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-bottom-left-radius: 0.25rem;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--color-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 0.8rem;
        }

        .message.user .message-avatar {
            background: var(--color-success);
            margin-left: auto;
        }

        /* å»ºè®®é—®é¢˜ */
        .suggestions {
            margin-top: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .suggestion-item {
            padding: 0.75rem 1rem;
            background: var(--color-background);
            border: 1px solid var(--color-border);
            border-radius: var(--radius);
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9rem;
        }

        .suggestion-item:hover {
            border-color: var(--color-primary);
            background: rgba(37, 99, 235, 0.05);
        }

        /* è¾“å…¥åŒºåŸŸ */
        .chat-input-container {
            padding: 1.5rem;
            background: var(--color-surface);
            border-top: 1px solid var(--color-border);
        }

        .chat-input-wrapper {
            position: relative;
            max-width: 800px;
            margin: 0 auto;
        }

        .chat-input {
            width: 100%;
            padding: 1rem 4rem 1rem 1.5rem;
            border: 1px solid var(--color-border);
            border-radius: 1.5rem;
            font-size: 1rem;
            outline: none;
            background: var(--color-background);
            color: var(--color-text);
            resize: none;
            min-height: 52px;
            max-height: 120px;
        }

        .chat-input:focus {
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .send-button {
            position: absolute;
            right: 0.5rem;
            top: 50%;
            transform: translateY(-50%);
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 50%;
            background: var(--color-primary);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .send-button:hover:not(:disabled) {
            background: var(--color-primary-hover);
        }

        .send-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* çŠ¶æ€æŒ‡ç¤ºå™¨ */
        .status-bar {
            position: fixed;
            bottom: 1rem;
            left: 1rem;
            right: 1rem;
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius);
            padding: 0.75rem 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-indicator.ready {
            background: var(--color-success);
        }

        .status-indicator.thinking {
            background: var(--color-warning);
        }

        .status-indicator.error {
            background: var(--color-error);
        }

        /* è®¾ç½®æ¨¡æ€æ¡† */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .modal {
            background: var(--color-background);
            border-radius: var(--radius);
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--color-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-content {
            padding: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--color-text);
        }

        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--color-border);
            border-radius: var(--radius);
            font-size: 1rem;
            background: var(--color-background);
            color: var(--color-text);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .form-select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--color-border);
            border-radius: var(--radius);
            font-size: 1rem;
            background: var(--color-background);
            color: var(--color-text);
        }

        /* åŠ¨ç”» */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        /* åŠ è½½åŠ¨ç”» */
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--color-text-secondary);
        }

        .typing-dots {
            display: flex;
            gap: 0.25rem;
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--color-text-secondary);
            animation: typingDots 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typingDots {

            0%,
            60%,
            100% {
                opacity: 0.3;
            }

            30% {
                opacity: 1;
            }
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: 0;
                top: 0;
                height: 100vh;
                z-index: 1500;
                transform: translateX(-100%);
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .message {
                max-width: 95%;
            }
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // ä¸»åº”ç”¨ç»„ä»¶
        function App() {
            const [currentPage, setCurrentPage] = useState('chat');
            const [showSettings, setShowSettings] = useState(false);
            const [sidebarOpen, setSidebarOpen] = useState(false);
            const [sessionId, setSessionId] = useState(null);
            const [messages, setMessages] = useState([]);
            const [inputValue, setInputValue] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [status, setStatus] = useState({ status: 'ready', message: 'å°±ç»ªï¼Œç­‰å¾…æ‚¨çš„è¾“å…¥' });
            const [suggestions, setSuggestions] = useState([]);
            const [settings, setSettings] = useState({
                llmProvider: 'deepseek',
                apiKey: '',
                model: 'deepseek-reasoner'
            });

            const messagesEndRef = useRef(null);
            const inputRef = useRef(null);
            const wsRef = useRef(null);

            // æ»šåŠ¨åˆ°æ¶ˆæ¯åº•éƒ¨
            const scrollToBottom = () => {
                messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
            };

            useEffect(() => {
                scrollToBottom();
            }, [messages]);

            // WebSocketè¿æ¥
            useEffect(() => {
                if (sessionId) {
                    const wsUrl = `ws://localhost:3000/ws/${sessionId}`;
                    wsRef.current = new WebSocket(wsUrl);

                    wsRef.current.onmessage = (event) => {
                        const data = JSON.parse(event.data);
                        if (data.type === 'status') {
                            setStatus({ status: data.status, message: data.message });
                        }
                    };

                    wsRef.current.onerror = (error) => {
                        console.error('WebSocket error:', error);
                        setStatus({ status: 'error', message: 'è¿æ¥é”™è¯¯' });
                    };

                    return () => {
                        wsRef.current?.close();
                    };
                }
            }, [sessionId]);

            // å‘é€æ¶ˆæ¯
            const sendMessage = async (message = inputValue) => {
                if (!message.trim() || isLoading) return;

                const userMessage = { role: 'user', content: message };
                setMessages(prev => [...prev, userMessage]);
                setInputValue('');
                setIsLoading(true);
                setSuggestions([]);

                // æ·»åŠ æ‰“å­—æŒ‡ç¤ºå™¨
                const typingMessage = { role: 'assistant', content: '', isTyping: true };
                setMessages(prev => [...prev, typingMessage]);

                try {
                    const response = await fetch('/api/chat', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            message,
                            session_id: sessionId
                        })
                    });

                    if (!response.ok) throw new Error('è¯·æ±‚å¤±è´¥');

                    const data = await response.json();

                    setSessionId(data.session_id);

                    // ç§»é™¤æ‰“å­—æŒ‡ç¤ºå™¨ï¼Œæ·»åŠ å®é™…å›å¤
                    setMessages(prev => {
                        const newMessages = prev.slice(0, -1); // ç§»é™¤æ‰“å­—æŒ‡ç¤ºå™¨
                        return [...newMessages, { role: 'assistant', content: data.response }];
                    });

                    setSuggestions(data.suggestions || []);

                } catch (error) {
                    console.error('å‘é€æ¶ˆæ¯å¤±è´¥:', error);
                    setMessages(prev => prev.slice(0, -1)); // ç§»é™¤æ‰“å­—æŒ‡ç¤ºå™¨
                    setStatus({ status: 'error', message: 'å‘é€å¤±è´¥ï¼Œè¯·é‡è¯•' });
                } finally {
                    setIsLoading(false);
                }
            };

            // å¤„ç†é”®ç›˜äº‹ä»¶
            const handleKeyPress = (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            };

            // é€‰æ‹©å»ºè®®
            const selectSuggestion = (suggestion) => {
                sendMessage(suggestion);
            };

            // æ–°å¯¹è¯
            const startNewChat = () => {
                setMessages([]);
                setSessionId(null);
                setSuggestions([]);
                setStatus({ status: 'ready', message: 'å°±ç»ªï¼Œç­‰å¾…æ‚¨çš„è¾“å…¥' });
            };

            return (
                <div className="app-container">
                    {/* ä¾§è¾¹æ  */}
                    <div className={`sidebar ${sidebarOpen ? 'open' : ''}`}>
                        <div className="sidebar-header">
                            <div className="logo">
                                <i className="fas fa-robot"></i>
                                OpenManus
                            </div>
                        </div>
                        <div className="sidebar-content">
                            <div
                                className={`nav-item ${currentPage === 'chat' ? 'active' : ''}`}
                                onClick={() => setCurrentPage('chat')}
                            >
                                <i className="fas fa-comments"></i>
                                éœ€æ±‚åˆ†æ
                            </div>
                            <div
                                className="nav-item"
                                onClick={() => setShowSettings(true)}
                            >
                                <i className="fas fa-cog"></i>
                                è®¾ç½®
                            </div>
                            <div
                                className="nav-item"
                                onClick={startNewChat}
                            >
                                <i className="fas fa-plus"></i>
                                æ–°å¯¹è¯
                            </div>
                        </div>
                    </div>

                    {/* ä¸»å†…å®¹ */}
                    <div className="main-content">
                        {/* é¡¶éƒ¨æ  */}
                        <div className="top-bar">
                            <div style={{ display: 'flex', alignItems: 'center', gap: '1rem' }}>
                                <button
                                    className="btn btn-secondary"
                                    onClick={() => setSidebarOpen(!sidebarOpen)}
                                    style={{ display: 'none' }}
                                >
                                    <i className="fas fa-bars"></i>
                                </button>
                                <div className="page-title">éœ€æ±‚åˆ†æåŠ©æ‰‹</div>
                            </div>
                            <div className="top-actions">
                                <button
                                    className="btn btn-secondary"
                                    onClick={() => setShowSettings(true)}
                                >
                                    <i className="fas fa-cog"></i>
                                    è®¾ç½®
                                </button>
                            </div>
                        </div>

                        {/* èŠå¤©åŒºåŸŸ */}
                        <div className="chat-container">
                            <div className="chat-messages">
                                {messages.length === 0 && (
                                    <div style={{
                                        textAlign: 'center',
                                        padding: '3rem',
                                        color: 'var(--color-text-secondary)'
                                    }}>
                                        <i className="fas fa-robot" style={{ fontSize: '3rem', marginBottom: '1rem' }}></i>
                                        <h2>æ¬¢è¿ä½¿ç”¨ OpenManus</h2>
                                        <p>æˆ‘æ˜¯æ‚¨çš„AIéœ€æ±‚åˆ†æåŠ©æ‰‹ï¼Œè¯·æè¿°æ‚¨çš„é¡¹ç›®æƒ³æ³•</p>
                                    </div>
                                )}

                                {messages.map((message, index) => (
                                    <div key={index} className={`message ${message.role}`}>
                                        <div className="message-avatar">
                                            {message.role === 'user' ? 'æ‚¨' : 'AI'}
                                        </div>
                                        <div className="message-content">
                                            {message.isTyping ? (
                                                <div className="typing-indicator">
                                                    <span>æ­£åœ¨æ€è€ƒ</span>
                                                    <div className="typing-dots">
                                                        <div className="typing-dot"></div>
                                                        <div className="typing-dot"></div>
                                                        <div className="typing-dot"></div>
                                                    </div>
                                                </div>
                                            ) : (
                                                <div dangerouslySetInnerHTML={{
                                                    __html: message.content.replace(/\n/g, '<br>')
                                                }} />
                                            )}
                                        </div>
                                    </div>
                                ))}

                                {suggestions.length > 0 && (
                                    <div className="suggestions">
                                        <div style={{
                                            fontSize: '0.9rem',
                                            color: 'var(--color-text-secondary)',
                                            marginBottom: '0.5rem'
                                        }}>
                                            ğŸ’¡ å¿«é€Ÿå›ç­”ï¼š
                                        </div>
                                        {suggestions.map((suggestion, index) => (
                                            <div
                                                key={index}
                                                className="suggestion-item"
                                                onClick={() => selectSuggestion(suggestion)}
                                            >
                                                {suggestion}
                                            </div>
                                        ))}
                                    </div>
                                )}

                                <div ref={messagesEndRef} />
                            </div>

                            {/* è¾“å…¥åŒºåŸŸ */}
                            <div className="chat-input-container">
                                <div className="chat-input-wrapper">
                                    <textarea
                                        ref={inputRef}
                                        className="chat-input"
                                        placeholder="æè¿°æ‚¨çš„é¡¹ç›®éœ€æ±‚..."
                                        value={inputValue}
                                        onChange={(e) => setInputValue(e.target.value)}
                                        onKeyPress={handleKeyPress}
                                        disabled={isLoading}
                                        rows={1}
                                    />
                                    <button
                                        className="send-button"
                                        onClick={() => sendMessage()}
                                        disabled={isLoading || !inputValue.trim()}
                                    >
                                        <i className="fas fa-paper-plane"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* çŠ¶æ€æ  */}
                    <div className="status-bar">
                        <div className={`status-indicator ${status.status}`}></div>
                        <span>{status.message}</span>
                    </div>

                    {/* è®¾ç½®æ¨¡æ€æ¡† */}
                    {showSettings && (
                        <div className="modal-overlay" onClick={() => setShowSettings(false)}>
                            <div className="modal" onClick={(e) => e.stopPropagation()}>
                                <div className="modal-header">
                                    <h2>è®¾ç½®</h2>
                                    <button
                                        className="btn btn-secondary"
                                        onClick={() => setShowSettings(false)}
                                    >
                                        <i className="fas fa-times"></i>
                                    </button>
                                </div>
                                <div className="modal-content">
                                    <div className="form-group">
                                        <label className="form-label">LLM æä¾›å•†</label>
                                        <select
                                            className="form-select"
                                            value={settings.llmProvider}
                                            onChange={(e) => setSettings({ ...settings, llmProvider: e.target.value })}
                                        >
                                            <option value="deepseek">DeepSeek</option>
                                            <option value="openai">OpenAI</option>
                                            <option value="claude">Claude</option>
                                        </select>
                                    </div>
                                    <div className="form-group">
                                        <label className="form-label">æ¨¡å‹</label>
                                        <input
                                            type="text"
                                            className="form-input"
                                            value={settings.model}
                                            onChange={(e) => setSettings({ ...settings, model: e.target.value })}
                                            placeholder="æ¨¡å‹åç§°"
                                        />
                                    </div>
                                    <div className="form-group">
                                        <label className="form-label">API Key</label>
                                        <input
                                            type="password"
                                            className="form-input"
                                            value={settings.apiKey}
                                            onChange={(e) => setSettings({ ...settings, apiKey: e.target.value })}
                                            placeholder="è¾“å…¥æ‚¨çš„APIå¯†é’¥"
                                        />
                                    </div>
                                    <button
                                        className="btn btn-primary"
                                        onClick={() => setShowSettings(false)}
                                        style={{ width: '100%' }}
                                    >
                                        ä¿å­˜è®¾ç½®
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // æ¸²æŸ“åº”ç”¨
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>

</html>
